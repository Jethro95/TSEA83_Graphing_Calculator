\documentclass[]{article}

%Font encoding for swedish
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

%Swedish
\usepackage[swedish]{babel}

%Concentrated lists
\usepackage{mdwlist}

\usepackage{tikz}
\usetikzlibrary{shapes,arrows,calc}


%opening
\title{Grafritande Räknare - Designskiss}
\author{Hannes Haglund hanha265\\Felix Härnström felha423\\Silas Lenz sille914}

\begin{document}

\maketitle
\newpage

\section{}
Vi ska implementera en generell dator av mikroprogrammerad, ej pipelinead typ. Mjukvaran skrivs i assembler. Vi har en VGA-motor, en tangentbordsavkodare och möjligtvis touchavkodare samt motor för dess skärm (utökningsmål). 

\tikzstyle{block} = [draw, fill=blue!20, rectangle, 
minimum height=3em, minimum width=6em]
\tikzstyle{sum} = [draw, fill=blue!20, circle, node distance=1cm]
\tikzstyle{input} = [coordinate]
\tikzstyle{output} = [coordinate]
\tikzstyle{pinstyle} = [pin edge={to-,thin,black}]
\begin{center}


\begin{tikzpicture}[auto, node distance=2cm,>=latex']



\node [block, node distance=3cm] (cpu) {CPU};
\node [block, below of=cpu, node distance=2cm] (memory) {Minne};
\node [output, right of=cpu] (foo) {};


\draw [<->] (cpu) -- node[near start]{} (memory);
\node [block, above of=cpu] (keyboarddriver) {Tangentbordsmotor};
\node [block, node distance=3.5cm, left of=keyboarddriver] (keyboard) {Tangentbord};

\draw [<->] (keyboarddriver) -- node {} (cpu);
\draw [->] (keyboard) -- node {} (keyboarddriver);

\node [block, node distance=2cm, below of=memory] (driver) {VGA-motor};
\node [block, right of=driver, node distance=3.5cm] (vga) {Skärm};
\draw [->] (memory) -- node {} (driver);
\draw [->] (driver) -- node {} (vga);
\draw[thick,dotted] ($(keyboarddriver.north west)+(-0.3,0.3)$)  rectangle ($(driver.south east)+(1,-0.3)$) node[pos=0] {FPGA};
\end{tikzpicture}
\end{center}

\subsection{CPU}
Vår processor är mikroprogrammerad, med delat data och programminne. Vi använder 32-bitars ordbredd. Endast blockram används.

Processor laddas alltid med samma program vid start. 

Nästan allt arbete utförs av processorn, förutom tangentbordläsning, och utritning av bildminnets innehåll. Dessa uppgifter inkluderar: beräkningar, historik, parsing av input, beräkning av graf, och så vidare.

\subsubsection{Instruktioner}
Vi har följande adresseringsmoder:
\begin{itemize*}
\item Direkt
\item Omedelbar
\item Indirekt 
\end{itemize*}
Följande instruktionsmängd:
%TODO: I table. Beskriv vad varje gör.
\begin{itemize*}
\item LOAD
\item STORE
\item ADD
\item SUB
\item ADDF (add floats)
\item SUBF
\item MULTF
\item DIVF
\item AND
\item ASR
\item ASL
\item BRA
\item BNE
\item BMI
\item BEQ
\item BRF (branch overflow)
\item HALT	
\end{itemize*}

\subsection{Grafik} 
Vi delar upp vår display i två kolumner, där ena hälften använder tiles och andra hälften använder en bitmap i svartvitt. Räknaren (text) använder sidan med tiles, och grafen använder bitmapsidan.

Upplösning 640x480. Både tiles och bitmap i svartvitt. Uppdateringsfrekvens 60Hz.

Processorn skriver tilenummer samt bitmapen direkt till bildminnet, utan att synkronisera med bilduppritningen.

%TODO: Blockschema VGA_MOTOR

\subsection{I/O}
Input via PS/2 med en avkodare i \textsc{vhdl}. Avkodaren skriver ett tecken till en egen minnesplats som kan läsas av processorn via STORE. Vi låter instruktionen ta en virtuell adress som argument, och en viss adress som överskrider processorns minnesstorlek får referera till avkodarens minnescell.

Via en synkron \textit{read\_confirm}-signal så berättar processorn för avkodaren att den lyckats läsa ett tecken, varpå värdet på minnesplatsen nollställs och avkodaren påbörjar läsning av nästa tecken.

Hämtad input ritas ut i ett konsolfönster på skärmen, och interpreteras vid nedslag av returknappen. Tal matas in i form av flyttal (separerad med punk), och uttryck skrivs i reverse-polish-notation.

%TODO: Blockschema tangentbordsmotor

\subsection{Minne}
Vi har följande minnen:
\begin{itemize*}
\item PC (rw)
\item ASR (rw)
\item IR (rw)
\item $\mu$PC (rw)
\item $\mu$Minne (rw)
\item Programminne (rw)
\item 6 generella dataregister (rw)
\item Statusregister (r)
\item Bildminne
\end{itemize*}
Med ordbredden 32 bitar.

\subsection{Programmering}
Vi skriver en assembler, med lite syntaktiskt socker för loopar och if-satser.

\subsection{Milstolpe}
En fungerande processor som kan rita ut flyttal från en adress i minnet med hjälp av VGA-motor.
\end{document}
