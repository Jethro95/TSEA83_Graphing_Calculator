\documentclass[]{article}
%Font encoding for swedish
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

\usepackage{tikz}
\usetikzlibrary{shapes,arrows,calc}


% Title Page
\title{Teknisk rapport\\Grafisk räknare}
\author{}


\begin{document}
\maketitle

\begin{abstract}
\end{abstract}
\section{Inledning}

\section{Apparaten}
Börja gärna med en bild på bygget och redgör för hur apparaten används. Detta blir en kombinerad presentation av konstruktionen och användarhandledning. 
\section{Teori}
Här kan ett videoprojekt beskriva videoformatet, ett MIDI-projekt redogöra för MIDI-standarden ...
\subsection{Reverse polish}
\section{Hårdvaran}
Börja med ett översiktligt blockschema, gå vidare till mera detaljerade blockschemor. Vill man rita figurer och blockschemor på datorn så är Inkscape ett bra alternativ. Handritade figurer och blockschemor är acceptabelt, bara de är snygga och väl läsbara, MEN dessa ska då vara inscannade, dvs avfotograferade figurer och blockschemor är INTE godtagbart.
Beskriv sedan hur de olika blocken fungerar. Tänk på läsbarheten och växla mellan figurer och text. Den här typen av text är ganska "grafisk", då nästan varje mening syftar in i en figur. Var därför noga med att text och figurer stämmer överens.
\subsection{Översikt}
TODO

\tikzstyle{block} = [draw, fill=blue!20, rectangle, 
minimum height=3em, minimum width=6em]
\tikzstyle{sum} = [draw, fill=blue!20, circle, node distance=1cm]
\tikzstyle{input} = [coordinate]
\tikzstyle{output} = [coordinate]
\tikzstyle{pinstyle} = [pin edge={to-,thin,black}]

\begin{figure}[h!]
	\centering
	\begin{tikzpicture}[auto, node distance=2cm,>=latex']
	
	
	
	\node [block, node distance=3cm] (cpu) {CPU};
	\node [block, below of=cpu, node distance=2cm] (memory) {Bildminne};
	\node [output, right of=cpu] (foo) {};
	
	
	\draw [<->] (cpu) -- node[near start]{} (memory);
	\node [block, above of=cpu] (keyboarddriver) {Tangentbordsmotor};
	\node [block, node distance=3.5cm, left of=keyboarddriver] (keyboard) {Tangentbord};
	
	\draw [<->] (keyboarddriver) -- node {} (cpu);
	\draw [->] (keyboard) -- node {} (keyboarddriver);
	
	\node [block, node distance=2cm, below of=memory] (driver) {VGA-motor};
	\node [block, right of=driver, node distance=3.5cm] (vga) {Skärm};
	\draw [->] (memory) -- node {} (driver);
	\draw [->] (driver) -- node {} (vga);
	\draw[thick,dotted] ($(keyboarddriver.north west)+(-0.3,0.3)$)  rectangle ($(driver.south east)+(1,-0.3)$) node[pos=0] {FPGA};
	\end{tikzpicture}
	\caption{Översiktligt blockschema.}
\end{figure}

\subsection{CPU}

CPU:n är av relativt enkel design, ej pipelinad. Huvudminnet, och de allra flesta register inklusive de generella, är 32 bitar långa.

\subsubsection{mPC}



\subsubsection{AR/ALU}

I processen titulerad AR finns koden som utgör enhetens ALU.

Här modifieras ackumulatorregistret, AR, (32 bitar), och de fem flaggorna. En rad olika operationer kan utföras på positiv klockflank beroende på kuden hos ALU-signalen; de fem första bitarna i microminnesinstruktionen som för tillfället körs.

Vid matematiska operationer tolkas AR och bussens värde som ett signerat två-komplementstal, det vill säga att de kan båda anta negativa värden.

AR:s värde kan senare läggas på bussen via att ange koden \texttt{0101} i microkoden. Den kan dock ej skrivas till direkt.

Nedan följer en tabell över alla ALU-operationer: deras koder, funktion, och modifierade flaggor.

\begin{tabular}{llc}
\textbf{Kod} & \textbf{Funktion} & \textbf{Flaggor påverkade}\\
\hline
\texttt{00000} & <Ingenting> & \\
\texttt{00001} & AR := BUS &  \\
\texttt{00010} & AR := BUS' & \\
\texttt{00011} & AR := 0 & \\
\texttt{00100} & AR := AR+BUS & \texttt{X C V N Z}\\
\texttt{00101} & AR := AR-BUS & \texttt{X C V N Z} \\
\texttt{00110} & AR := AR \textsc{and} BUS & \texttt{{ } C V N Z}\\
\texttt{00111} & AR := \textit{signed\_to\_real}(AR) & \\
\texttt{01000} & AR := \textit{real\_to\_signed}(AR) & \\
\texttt{01001} & AR := AR \textsc{asr} BUS & \texttt{X C V N Z}\\
\texttt{01010} & AR := AR \textsc{asl} BUS & \texttt{X C V N Z}\\
\texttt{01011} & AR := AR+BUS (fixed point) & \texttt{X C V N Z} \\
\texttt{01100} & AR := AR-BUS (fixed point) & \texttt{X C V N Z} \\
\texttt{01101} & AR := AR*BUS (fixed point) &  \\
\texttt{01110} & \texttt{<Undefined>} & \\
\texttt{01111} & AR := AR \textsc{lsr} BUS & \texttt{X C { } N Z}\\
\texttt{10000} & AR := AR \textsc{lsl} BUS & \texttt{X C { } N Z}\\
\texttt{Others} & \texttt{<Undefined>} &
\end{tabular}



\subsection{Tangentbordsmotor}

\subsection{Bildminne}
\begin{figure}[h!]
	\makebox[\textwidth][c]{\includegraphics[width=1\textwidth]{drawings/pic_mem.png}}
	\caption{Blockschema över bildminnet}
\end{figure}

Bildminnet är uppdelat i två kolumner, där ena hälften använder tiles och andra hälften använder en bitmap. Bitmapminnet innehåller 320x480 bitars blockram för en svartvit representation av alla pixlar på vänstra skärmhalvan. Bildminnet för tiles innehåller 40x30 rader.

Varje del har en write\_enable-signal, en save\_at-signal och en data\_in-signal. När write\_enable ettställs ersätts innehållet på adressen save\_at med data\_in. Bitmapminnet använder endast sista biten i data\_in\_b, medans hela data\_in\_p används.

Xpixel och Ypixel används för att bestämma om picmem\_out eller bitmem\_out ska uppdateras, för att undvika overflow i minnena.

\subsection{VGA-motor}
\begin{figure}[h!]
	\makebox[\textwidth][c]{\includegraphics[width=1\textwidth]{drawings/vga_motor.png}}
	\caption{Översiktligt blockschema över VGA-motorn}
\end{figure}

\section{Mjukvara}
\subsection{Hjälpmedel}

\subsection{Calc}

\subsection{Beräkningar}
\subsubsection{Reverse polish}
\subsubsection{Eval\_fn}
\subsubsection{Division}

\subsection{Grafer}
\subsubsection{Axlar}
\subsubsection{Utritning}

\subsection{IO}
\subsubsection{Print-num}
\subsubsection{TODO}

\section{Slutsatser}
\section{Referenser}
\section{VHDL-dokumentation}
\subsection{CPU}

\subsection{Tangentbordsmotor}

\subsection{Bildminne}

\subsection{VGAMotor}

\subsection{Testbenches}
Inte själva VHDL-koden utan en förklaring av den. Typiskt en förklaring av varje process.


\end{document}          
